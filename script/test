#!/usr/bin/env nix-shell
#!nix-shell -i bash
#!nix-shell -I nixpkgs=./nix
#!nix-shell -p nix

set -euo pipefail

export NIX_PATH="nixpkgs=./nix"

echo "Building"

extraArgs=( )

if [ "${1:-}" == "--fast" ]; then
    echo "running only fast tests"
    extraArgs+=( --arg fast true )
else
    echo "running all tests"
fi

# Build and create a root
nix-build ./test.nix --sandbox --no-link --max-jobs 10 "${extraArgs[@]}"

echo "all good"
